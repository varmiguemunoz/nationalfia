---
import type { InferGetStaticParamsType } from 'astro';
import { getBlog, getBlogs } from '@utils/sanity';
import { PortableText } from 'astro-portabletext';

import { Mark } from 'astro-portabletext/components';
import Blog from '@layouts/Blog.astro';

export async function getStaticPaths() {
  const posts = await getBlogs();

  return posts.map((item: any) => ({
    params: { slug: item.slug },
    props: item,
  }));
}

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
const { slug } = Astro.params as Params;

const blog = await getBlog(slug);

const component = {
  mark: Mark,
};
---

<Blog title={blog.title} shortDescription={blog.description} publishedAt={blog.publishedAt} mainImage={blog.mainImage}>
  <PortableText value={blog.body} components={component} />
</Blog>
